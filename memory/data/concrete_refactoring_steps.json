{
  "timestamp": "2025-07-07T08:45:00.000Z",
  "agent": "simplification_architect",
  "namespace": "swarm-auto-centralized-1751878040319/architect/",
  "concrete_refactoring_steps": {
    "phase1_display_system": {
      "title": "显示系统简化 - 具体实施步骤",
      "estimated_time": "4-6小时",
      "detailed_steps": [
        {
          "step": "1.1",
          "title": "移除CalcDisplayAdapter适配器层",
          "code_changes": [
            {
              "file": "src/main.cpp",
              "action": "modify",
              "changes": [
                "移除 #include \"CalcDisplayAdapter.h\"",
                "移除 displayAdapter 变量声明",
                "修改 calculator->setDisplay() 直接传入 display.get()",
                "移除 displayAdapter 相关的初始化代码"
              ]
            },
            {
              "file": "src/CalculatorCore.h",
              "action": "modify",
              "changes": [
                "修改 setDisplay() 方法参数类型从 CalculatorDisplay 改为 CalcDisplay",
                "更新 _display 成员变量类型"
              ]
            },
            {
              "file": "src/CalculatorCore.cpp", 
              "action": "modify",
              "changes": [
                "更新 updateDisplay() 方法直接调用 CalcDisplay 的方法",
                "移除适配器层的转换逻辑"
              ]
            }
          ],
          "validation": "编译通过，显示功能正常"
        },
        {
          "step": "1.2",
          "title": "简化CalculatorDisplay基类接口",
          "code_changes": [
            {
              "file": "include/CalculatorDisplay_base.h",
              "action": "modify",
              "changes": [
                "移除 setTheme() 纯虚函数",
                "移除 setNumberFormat() 纯虚函数", 
                "移除 setUnitDisplay() 纯虚函数",
                "删除 DisplayTheme, NumberFormat, UnitDisplay 结构体定义"
              ]
            }
          ],
          "validation": "编译通过，接口调用正常"
        },
        {
          "step": "1.3",
          "title": "删除适配器文件",
          "code_changes": [
            {
              "file": "src/CalcDisplayAdapter.h",
              "action": "delete",
              "changes": ["完全删除该文件"]
            }
          ],
          "validation": "编译通过，无引用错误"
        }
      ],
      "testing_checklist": [
        "数字显示正常",
        "表达式显示正常",
        "历史记录显示正常",
        "错误信息显示正常",
        "动画效果正常"
      ]
    },
    
    "phase2_calculation_engine": {
      "title": "计算引擎简化 - 具体实施步骤",
      "estimated_time": "6-8小时",
      "detailed_steps": [
        {
          "step": "2.1",
          "title": "移除插件式函数系统",
          "code_changes": [
            {
              "file": "src/CalculationEngine.h",
              "action": "modify",
              "changes": [
                "删除 CalculationFunction 抽象基类",
                "删除所有具体函数类声明",
                "移除 _functions 成员变量",
                "移除 addFunction() 和 callFunction() 方法",
                "添加静态内联数学函数声明"
              ]
            },
            {
              "file": "src/CalculationEngine.cpp",
              "action": "modify", 
              "changes": [
                "实现静态内联数学函数",
                "移除函数注册逻辑",
                "简化 begin() 方法"
              ]
            }
          ],
          "validation": "基础数学运算正常"
        },
        {
          "step": "2.2",
          "title": "简化CalculationResult结构体",
          "code_changes": [
            {
              "file": "src/CalculationEngine.h",
              "action": "modify",
              "changes": [
                "移除 precision 字段",
                "移除 calculationTime 字段",
                "保留 value, isValid, error, errorMessage 字段"
              ]
            }
          ],
          "validation": "错误处理正常"
        },
        {
          "step": "2.3",
          "title": "移除精度级别系统",
          "code_changes": [
            {
              "file": "src/CalculationEngine.h",
              "action": "modify",
              "changes": [
                "删除 PrecisionLevel 枚举",
                "移除 _precisionLevel 成员变量",
                "移除 setPrecisionLevel() 方法",
                "使用固定精度常量"
              ]
            }
          ],
          "validation": "计算精度符合预期"
        }
      ],
      "testing_checklist": [
        "四则运算正确",
        "小数运算正确",
        "错误处理正确",
        "边界值处理正确",
        "性能无明显下降"
      ]
    },
    
    "phase3_keyboard_system": {
      "title": "键盘系统简化 - 具体实施步骤",
      "estimated_time": "8-10小时",
      "detailed_steps": [
        {
          "step": "3.1",
          "title": "移除动态配置管理",
          "code_changes": [
            {
              "file": "src/KeypadControl.h",
              "action": "modify",
              "changes": [
                "添加静态键位映射数组",
                "移除配置管理相关的包含",
                "简化构造函数"
              ]
            },
            {
              "file": "src/KeypadControl.cpp",
              "action": "modify",
              "changes": [
                "实现静态键位映射",
                "移除配置加载逻辑",
                "简化初始化过程"
              ]
            },
            {
              "file": "src/KeyboardConfig.h",
              "action": "delete",
              "changes": ["删除整个配置管理文件"]
            }
          ],
          "validation": "按键映射正确"
        },
        {
          "step": "3.2",
          "title": "简化键盘控制接口",
          "code_changes": [
            {
              "file": "src/KeypadControl.h",
              "action": "modify",
              "changes": [
                "合并相似的配置方法",
                "移除不必要的查询方法",
                "简化反馈配置接口"
              ]
            }
          ],
          "validation": "所有保留的功能正常"
        }
      ],
      "testing_checklist": [
        "所有按键响应正常",
        "LED反馈正常",
        "蜂鸣器反馈正常",
        "长按功能正常",
        "组合键功能正常"
      ]
    },
    
    "final_validation": {
      "comprehensive_tests": [
        "完整的计算器功能测试",
        "内存使用量测试",
        "响应时间测试",
        "稳定性测试",
        "电池续航测试"
      ],
      "performance_benchmarks": [
        "启动时间",
        "按键响应时间",
        "显示刷新时间",
        "内存占用量",
        "Flash使用量"
      ],
      "code_quality_checks": [
        "编译无警告",
        "静态分析通过",
        "代码覆盖率",
        "文档完整性"
      ]
    }
  }
}